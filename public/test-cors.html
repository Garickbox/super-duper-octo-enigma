<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API - Telegram Camera Bot</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: #f5f5f5; padding: 15px; color: #333; line-height: 1.5; }
        .container { max-width: 1000px; margin: 0 auto; }
        .header { background: #0088cc; color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: center; }
        .nav-buttons { display: flex; gap: 8px; margin: 15px 0; flex-wrap: wrap; }
        .btn { background: #0088cc; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 13px; cursor: pointer; text-decoration: none; display: inline-block; flex: 1; min-width: 110px; }
        .btn:hover { background: #006699; }
        .btn-success { background: #28a745; }
        .btn-secondary { background: #6c757d; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 1px 5px rgba(0,0,0,0.1); }
        .result { padding: 10px; border-radius: 6px; margin: 6px 0; font-family: 'Courier New', monospace; font-size: 0.8rem; white-space: pre-wrap; word-break: break-all; border-left: 4px solid; }
        .success { background: #f8fff8; color: #2d5016; border-left-color: #28a745; }
        .warning { background: #fffbf0; color: #856404; border-left-color: #ffc107; }
        .info { background: #f0f8ff; color: #004064; border-left-color: #0088cc; }
        .error { background: #fff8f8; color: #8b0000; border-left-color: #dc3545; }
        .test-grid { display: grid; grid-template-columns: 1fr auto; gap: 6px; margin: 6px 0; align-items: center; }
        .url { font-family: 'Courier New', monospace; font-size: 0.75rem; background: #f8f9fa; padding: 5px; border-radius: 3px; word-break: break-all; }
        .summary { background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center; }
        .summary.success { background: #f8fff8; border: 2px solid #28a745; }
        .loading { display: inline-block; width: 14px; height: 14px; border: 2px solid #f3f3f3; border-top: 2px solid #0088cc; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß –¢–µ—Å—Ç API - Telegram Camera Bot</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞</p>
            <div style="margin-top: 8px; font-size: 0.8rem; opacity: 0.9;">üë§ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ì–æ—Ä—á–∞–∫–æ–≤ | üÜî 1189539923</div>
        </div>

        <div class="nav-buttons">
            <a href="index.html" class="btn btn-secondary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <a href="camera-app.html" class="btn">üì∑ –ö–∞–º–µ—Ä–∞</a>
            <button class="btn btn-success" id="testAllBtn" onclick="testAllEndpoints()">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë</button>
            <button class="btn" onclick="testCriticalEndpoints()">üîó –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ endpoints</button>
            <button class="btn btn-secondary" onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <div class="summary success">
            <h3>‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!</h3>
            <p>–í—Å–µ API endpoints –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ.</p>
        </div>
        
        <div class="card">
            <h3>üì° Endpoints –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            
            <div style="margin: 10px 0; padding: 10px; background: #fffbf0; border-radius: 5px;">
                <strong>‚ÑπÔ∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ö–æ—Ä–Ω–µ–≤–æ–π URL (/) –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å HTML - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Railway
            </div>
            
            <div class="test-grid">
                <div class="url">GET /api/bot-status</div>
                <button class="btn" onclick="testEndpoint('/api/bot-status')">–¢–µ—Å—Ç</button>
            </div>
            <div class="test-grid">
                <div class="url">GET /api/stats</div>
                <button class="btn" onclick="testEndpoint('/api/stats')">–¢–µ—Å—Ç</button>
            </div>
            <div class="test-grid">
                <div class="url">GET /api/logs</div>
                <button class="btn" onclick="testEndpoint('/api/logs')">–¢–µ—Å—Ç</button>
            </div>
            <div class="test-grid">
                <div class="url">GET /api/test</div>
                <button class="btn" onclick="testEndpoint('/api/test')">–¢–µ—Å—Ç</button>
            </div>
            <div class="test-grid">
                <div class="url">POST /api/send-photo</div>
                <button class="btn" onclick="testPhotoEndpoint()">–¢–µ—Å—Ç</button>
            </div>
        </div>
        
        <div class="card">
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 6px; padding: 10px; background: #f8f9fa;">
                <div id="results">
                    <div class="result info">
                        –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö endpoints.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'https://telegram-camera-bot-production.up.railway.app';
        let isTesting = false;
        
        function addResult(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<div style="color: #6c757d; font-size: 0.7rem;">[${timestamp}]</div>${message}`;
            document.getElementById('results').appendChild(resultDiv);
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function setButtonLoading(button, loading) {
            if (loading) {
                button.dataset.originalText = button.innerHTML;
                button.innerHTML = '<div class="loading"></div> –ó–∞–≥—Ä—É–∑–∫–∞...';
                button.disabled = true;
            } else {
                button.innerHTML = button.dataset.originalText || '–¢–µ—Å—Ç';
                button.disabled = false;
            }
        }

        async function testEndpoint(endpoint, button = null) {
            const url = BACKEND_URL + endpoint;
            const startTime = Date.now();
            
            if (button) {
                setButtonLoading(button, true);
            }
            
            addResult(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: GET ${url}`, 'info');
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                const duration = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ –£–°–ü–ï–•: ${endpoint} (${duration}ms)\n–°—Ç–∞—Ç—É—Å: ${data.status || 'OK'}`, 'success');
                    return true;
                } else {
                    addResult(`‚ùå –û–®–ò–ë–ö–ê: HTTP ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                const duration = Date.now() - startTime;
                addResult(`‚ùå –û–®–ò–ë–ö–ê: ${error.message} (${duration}ms)`, 'error');
                return false;
            } finally {
                if (button) {
                    setButtonLoading(button, false);
                }
            }
        }

        async function testPhotoEndpoint(button = null) {
            const url = BACKEND_URL + '/api/send-photo';
            const startTime = Date.now();
            
            if (button) {
                setButtonLoading(button, true);
            }
            
            addResult(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: POST ${url}`, 'info');
            
            const testImageData = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=';
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: 1189539923,
                        photo_data: testImageData,
                        caption: '–¢–µ—Å—Ç–æ–≤–æ–µ —Ñ–æ—Ç–æ'
                    })
                });

                const duration = Date.now() - startTime;
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        addResult(`‚úÖ –£–°–ü–ï–•: –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (${duration}ms)`, 'success');
                        return true;
                    } else {
                        addResult(`‚ö†Ô∏è –û–®–ò–ë–ö–ê –ë–û–¢–ê: ${result.error}`, 'warning');
                        return false;
                    }
                } else {
                    addResult(`‚ùå –û–®–ò–ë–ö–ê: HTTP ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                const duration = Date.now() - startTime;
                addResult(`‚ùå –û–®–ò–ë–ö–ê: ${error.message} (${duration}ms)`, 'error');
                return false;
            } finally {
                if (button) {
                    setButtonLoading(button, false);
                }
            }
        }
        
        async function testAllEndpoints() {
            if (isTesting) return;
            
            isTesting = true;
            const testAllBtn = document.getElementById('testAllBtn');
            setButtonLoading(testAllBtn, true);
            
            addResult('üöÄ –ó–ê–ü–£–°–ö –ü–û–õ–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø', 'info');
            
            const endpoints = [
                '/api/bot-status',
                '/api/stats', 
                '/api/logs',
                '/api/test'
            ];
            
            let successCount = 0;
            let totalCount = endpoints.length + 1; // +1 –¥–ª—è photo endpoint
            
            for (const endpoint of endpoints) {
                const success = await testEndpoint(endpoint);
                if (success) successCount++;
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            const photoSuccess = await testPhotoEndpoint();
            if (photoSuccess) successCount++;
            
            addResult(`üìä –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û: ${successCount}/${totalCount} —É—Å–ø–µ—à–Ω–æ`, 
                     successCount === totalCount ? 'success' : 'warning');
            
            setButtonLoading(testAllBtn, false);
            isTesting = false;
        }

        async function testCriticalEndpoints() {
            if (isTesting) return;
            
            isTesting = true;
            addResult('üîó –¢–ï–°–¢ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• ENDPOINTS', 'info');
            
            // –¢–æ–ª—å–∫–æ —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ endpoints
            await testEndpoint('/api/bot-status');
            await new Promise(resolve => setTimeout(resolve, 300));
            await testEndpoint('/api/test');
            
            addResult('‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç', 'success');
            isTesting = false;
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '<div class="result info">–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã</div>';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π event
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const buttons = document.querySelectorAll('.test-grid .btn');
            buttons.forEach(button => {
                const originalOnClick = button.onclick;
                button.onclick = function(event) {
                    originalOnClick.call(this, event);
                };
            });
        });
    </script>
</body>
</html>
