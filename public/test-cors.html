<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS Test - Telegram Camera Bot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #f5f5f5;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            background: #0088cc;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .btn {
            background: #0088cc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #006699;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .result {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .success {
            background: #d4ffd4;
            color: #006400;
            border: 1px solid #006400;
        }
        
        .error {
            background: #ffd4d4;
            color: #640000;
            border: 1px solid #640000;
        }
        
        .info {
            background: #d4eaff;
            color: #004064;
            border: 1px solid #004064;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }
        
        .url {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CORS</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±—ç–∫–µ–Ω–¥—É Telegram Camera Bot</p>
        </div>
        
        <div class="card">
            <h3>üåê –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏</h3>
            <p><strong>Backend URL:</strong> <code>https://telegram-camera-bot-production.up.railway.app</code></p>
            <p><strong>Frontend URL:</strong> <code id="frontendUrl">–ó–∞–≥—Ä—É–∑–∫–∞...</code></p>
            <p><strong>User ID:</strong> <code>1189539923</code></p>
            
            <div style="margin: 20px 0;">
                <button class="btn" onclick="testAllEndpoints()">üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints</button>
                <button class="btn btn-secondary" onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
            </div>
        </div>
        
        <div class="card">
            <h3>üì° –î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            
            <div class="test-grid">
                <div class="url">GET /</div>
                <button class="btn" onclick="testEndpoint('/')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            
            <div class="test-grid">
                <div class="url">GET /api/bot-status</div>
                <button class="btn" onclick="testEndpoint('/api/bot-status')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            
            <div class="test-grid">
                <div class="url">GET /api/stats</div>
                <button class="btn" onclick="testEndpoint('/api/stats')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            
            <div class="test-grid">
                <div class="url">GET /api/logs</div>
                <button class="btn" onclick="testEndpoint('/api/logs')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            
            <div class="test-grid">
                <div class="url">GET /api/test</div>
                <button class="btn" onclick="testEndpoint('/api/test')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            
            <div class="test-grid">
                <div class="url">POST /api/send-photo</div>
                <button class="btn" onclick="testPhotoEndpoint()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
        
        <div class="card">
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div id="results">
                <div class="result info">
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints" –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
                </div>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'https://telegram-camera-bot-production.up.railway.app';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
        document.getElementById('frontendUrl').textContent = window.location.origin;
        
        function addResult(message, type = 'info') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
            document.getElementById('results').appendChild(resultDiv);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '<div class="result info">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã</div>';
        }
        
        async function testEndpoint(endpoint) {
            const url = BACKEND_URL + endpoint;
            const startTime = Date.now();
            
            addResult(`üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${url}`, 'info');
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const duration = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`‚úÖ –£–°–ü–ï–•: ${endpoint} (${duration}ms)\n–°—Ç–∞—Ç—É—Å: ${data.status || 'OK'}\nCORS: –†–∞–±–æ—Ç–∞–µ—Ç`, 'success');
                } else {
                    addResult(`‚ùå –û–®–ò–ë–ö–ê: ${endpoint} - HTTP ${response.status}: ${response.statusText}`, 'error');
                }
            } catch (error) {
                const duration = Date.now() - startTime;
                addResult(`‚ùå –û–®–ò–ë–ö–ê: ${endpoint} (${duration}ms)\n${error.message}`, 'error');
                
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    addResult('‚ö†Ô∏è –í–û–ó–ú–û–ñ–ù–ê CORS –û–®–ò–ë–ö–ê: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ', 'error');
                }
            }
        }
        
        async function testPhotoEndpoint() {
            const url = BACKEND_URL + '/api/send-photo';
            const startTime = Date.now();
            
            addResult(`üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${url}`, 'info');
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ base64 –¥–∞–Ω–Ω—ã–µ (–º–∞–ª–µ–Ω—å–∫–æ–µ –∫—Ä–∞—Å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1x1 –ø–∏–∫—Å–µ–ª—å)
            const testImageData = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=';
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: 118
