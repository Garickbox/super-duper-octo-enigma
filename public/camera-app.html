// –í camera-app.html - –û–ë–ù–û–í–ò–¢–ï –≠–¢–ò –§–£–ù–ö–¶–ò–ò:

async function checkServerConnection() {
    const startTime = Date.now();
    try {
        const response = await fetch('https://telegram-camera-bot-production.up.railway.app/api/bot-status', {
            method: 'GET',
            mode: 'cors', // ‚≠ê –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∂–∏–º CORS
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        const responseTime = Date.now() - startTime;
        
        document.getElementById('connectionStatus').textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
        document.getElementById('connectionStatus').style.color = 'green';
        document.getElementById('responseTime').textContent = responseTime + 'ms';
        document.getElementById('responseTime').style.color = responseTime < 500 ? 'green' : responseTime < 1000 ? 'orange' : 'red';
        addLog(`–°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω (–æ—Ç–≤–µ—Ç: ${responseTime}ms)`, 'info');
        
        if (data.status === 'ACTIVE') {
            addLog(`–ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω: ${data.bot.first_name} (@${data.bot.username})`, 'info');
        }
        
    } catch (error) {
        console.error('Connection error:', error);
        document.getElementById('connectionStatus').textContent = '‚ùå –û—à–∏–±–∫–∞';
        document.getElementById('connectionStatus').style.color = 'red';
        document.getElementById('responseTime').textContent = '–û—à–∏–±–∫–∞';
        document.getElementById('responseTime').style.color = 'red';
        
        if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
            addLog('‚ùå CORS –æ—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –Ω–∞ –±—ç–∫–µ–Ω–¥–µ.', 'error');
        } else {
            addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
        }
    }
}

async function loadLogs() {
    try {
        document.getElementById('logsSection').style.display = 'block';
        document.getElementById('logsContainer').innerHTML = '<div class="log-entry">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</div>';
        
        const response = await fetch('https://telegram-camera-bot-production.up.railway.app/api/logs', {
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        if (data.status === 'SUCCESS') {
            let logsHTML = '';
            data.logs.forEach(log => {
                const time = new Date(log.timestamp).toLocaleTimeString();
                logsHTML += `
                    <div class="log-entry">
                        <span class="log-timestamp">[${time}]</span>
                        <span class="log-${log.level.toLowerCase()}">${log.level}:</span>
                        ${log.message}
                        ${log.data ? `<br><small>${JSON.stringify(log.data)}</small>` : ''}
                    </div>
                `;
            });
            
            document.getElementById('logsContainer').innerHTML = logsHTML || '<div class="log-entry">–õ–æ–≥–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>';
        } else {
            document.getElementById('logsContainer').innerHTML = `<div class="log-entry log-error">–û—à–∏–±–∫–∞: ${data.message}</div>`;
        }
    } catch (error) {
        console.error('Load logs error:', error);
        document.getElementById('logsContainer').innerHTML = `<div class="log-entry log-error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
    }
}

async function loadStats() {
    try {
        document.getElementById('statsSection').style.display = 'block';
        document.getElementById('statsGrid').innerHTML = '<div class="stat-card">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>';
        
        const response = await fetch('https://telegram-camera-bot-production.up.railway.app/api/stats', {
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        const statsHTML = `
            <div class="stat-card">
                <div>üïí Uptime</div>
                <div class="stat-value">${data.server.uptime}</div>
            </div>
            <div class="stat-card">
                <div>üß† Memory</div>
                <div class="stat-value">${Math.round(data.server.memory.heapUsed / 1024 / 1024)}MB</div>
            </div>
            <div class="stat-card">
                <div>üîß Node.js</div>
                <div class="stat-value">${data.server.nodeVersion}</div>
            </div>
            <div class="stat-card">
                <div>ü§ñ Bot</div>
                <div class="stat-value">${data.environment.botTokenSet ? '‚úÖ' : '‚ùå'}</div>
            </div>
            <div class="stat-card">
                <div>üåê CORS</div>
                <div class="stat-value">${data.cors ? '‚úÖ' : '‚ùå'}</div>
            </div>
            <div class="stat-card">
                <div>üì° Origin</div>
                <div class="stat-value" style="font-size: 0.7rem;">${data.cors?.origin || 'unknown'}</div>
            </div>
        `;
        
        document.getElementById('statsGrid').innerHTML = statsHTML;
    } catch (error) {
        console.error('Load stats error:', error);
        document.getElementById('statsGrid').innerHTML = `<div class="stat-card">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
    }
}
