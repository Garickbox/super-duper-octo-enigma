<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–º–µ—Ä–∞ –¥–ª—è Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: system-ui; }
        body { background: #fff; padding: 15px; }
        .container { max-width: 500px; margin: 0 auto; }
        header { background: #0088cc; color: white; padding: 15px; text-align: center; border-radius: 12px; margin-bottom: 15px; }
        .card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { background: #0088cc; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; margin: 5px 0; font-size: 16px; cursor: pointer; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .camera-preview { width: 100%; height: 300px; background: #000; border-radius: 12px; position: relative; margin-bottom: 15px; }
        .camera-preview video { width: 100%; height: 100%; object-fit: cover; }
        #cameraInfo { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center; }
        .status { padding: 10px; margin: 10px 0; border-radius: 8px; text-align: center; }
        .success { background: #d4ffd4; color: #006400; }
        .error { background: #ffd4d4; color: #640000; }
        .info { background: #d4eaff; color: #004064; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∑ –ö–∞–º–µ—Ä–∞ –≤ Telegram</h1>
            <p>–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (User ID: 1189539923)</p>
        </header>

        <div class="card">
            <div class="camera-preview">
                <video id="videoElement" autoplay playsinline></video>
                <div id="cameraInfo">
                    <div style="font-size: 48px;">üì∑</div>
                    <div>–ù–∞–∂–º–∏—Ç–µ "–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É"</div>
                </div>
            </div>
            
            <button class="btn" id="startCameraBtn">üì∑ –í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
            <button class="btn" id="captureBtn" disabled>üì∏ –°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫</button>
            <button class="btn" id="stopCameraBtn" disabled>‚èπÔ∏è –í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
        </div>

        <div class="card" id="photoPreviewCard" style="display: none;">
            <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ</h3>
            <img id="previewImage" style="width: 100%; border-radius: 8px; margin: 10px 0;">
            <input type="text" id="photoCaption" placeholder="–ü–æ–¥–ø–∏—Å—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px;">
            <button class="btn" id="sendToBotBtn">‚úàÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É</button>
            <button class="btn" id="retakePhotoBtn">üîÑ –ü–µ—Ä–µ—Å–Ω—è—Ç—å —Ñ–æ—Ç–æ</button>
        </div>

        <div id="statusMessage"></div>
    </div>

    <script>
        const SERVER_URL = 'https://telegram-camera-bot-production.up.railway.app/api/send-photo';
        const YOUR_USER_ID = 1189539923; // –í–∞—à ID
        
        let mediaStream = null;
        let currentPhotoData = null;

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('startCameraBtn').addEventListener('click', initializeCamera);
            document.getElementById('captureBtn').addEventListener('click', captureImage);
            document.getElementById('stopCameraBtn').addEventListener('click', stopCamera);
            document.getElementById('sendToBotBtn').addEventListener('click', sendPhotoToBot);
            document.getElementById('retakePhotoBtn').addEventListener('click', retakePhoto);
            
            showStatus('üîß –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω\nUser ID: ' + YOUR_USER_ID, 'info');
        });

        async function initializeCamera() {
            try {
                showStatus('–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...', 'info');
                if (mediaStream) stopCamera();
                
                mediaStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } 
                });
                
                const video = document.getElementById('videoElement');
                video.srcObject = mediaStream;
                
                video.onloadedmetadata = () => {
                    document.getElementById('cameraInfo').style.display = 'none';
                    document.getElementById('startCameraBtn').disabled = true;
                    document.getElementById('captureBtn').disabled = false;
                    document.getElementById('stopCameraBtn').disabled = false;
                    showStatus('‚úÖ –ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞', 'success');
                };
            } catch (error) {
                showStatus('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ', 'error');
            }
        }

        function captureImage() {
            const video = document.getElementById('videoElement');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            currentPhotoData = canvas.toDataURL('image/jpeg', 0.8);
            
            document.getElementById('previewImage').src = currentPhotoData;
            video.style.display = 'none';
            document.getElementById('photoPreviewCard').style.display = 'block';
            
            showStatus('‚úÖ –§–æ—Ç–æ –≥–æ—Ç–æ–≤–æ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ', 'success');
        }

        function retakePhoto() {
            document.getElementById('videoElement').style.display = 'block';
            document.getElementById('photoPreviewCard').style.display = 'none';
            document.getElementById('photoCaption').value = '';
            currentPhotoData = null;
        }

        function stopCamera() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            document.getElementById('videoElement').srcObject = null;
            document.getElementById('startCameraBtn').disabled = false;
            document.getElementById('captureBtn').disabled = true;
            document.getElementById('stopCameraBtn').disabled = true;
            document.getElementById('cameraInfo').style.display = 'block';
        }

        // ‚≠ê –°–ê–ú–ê–Ø –í–ê–ñ–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø - –£–õ–¨–¢–†–ê-–ü–†–û–°–¢–ê–Ø
        async function sendPhotoToBot() {
            if (!currentPhotoData) {
                showStatus('‚ùå –ù–µ—Ç —Ñ–æ—Ç–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error');
                return;
            }
            
            showStatus('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ...', 'info');
            document.getElementById('sendToBotBtn').disabled = true;
            document.getElementById('sendToBotBtn').innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            try {
                // –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à ID
                const result = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_id: YOUR_USER_ID, // ‚≠ê –í–ê–® ID
                        photo_data: currentPhotoData,
                        caption: document.getElementById('photoCaption').value
                    })
                }).then(r => r.json());
                
                if (result.success) {
                    showStatus('‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!\n(–Ω–∞ User ID: ' + YOUR_USER_ID + ')', 'success');
                } else {
                    showStatus('‚ùå –û—à–∏–±–∫–∞: ' + result.error, 'error');
                }
            } catch (error) {
                showStatus('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            } finally {
                document.getElementById('sendToBotBtn').disabled = false;
                document.getElementById('sendToBotBtn').innerHTML = '‚úàÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É';
            }
        }

        function showStatus(message, type) {
            const el = document.getElementById('statusMessage');
            el.textContent = message;
            el.className = 'status ' + type;
            setTimeout(() => el.textContent = '', 5000);
        }
    </script>
</body>
</html>