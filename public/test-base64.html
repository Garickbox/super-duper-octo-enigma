<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Base64 - Telegram Camera</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: system-ui; }
        body { background: #f5f5f5; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { background: #0088cc; color: white; border: none; padding: 12px 20px; border-radius: 8px; margin: 5px; font-size: 16px; cursor: pointer; }
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: monospace; }
        .result { padding: 15px; border-radius: 8px; margin: 10px 0; }
        .success { background: #d4ffd4; color: #006400; }
        .error { background: #ffd4d4; color: #640000; }
        .info { background: #d4eaff; color: #004064; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h2>üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Base64 –¥–∞–Ω–Ω—ã—Ö</h2>
            <p>–í—Å—Ç–∞–≤—å—Ç–µ base64 —Å—Ç—Ä–æ–∫—É —Ñ–æ—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</p>
            
            <textarea id="base64Input" placeholder="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQ..."></textarea>
            
            <button class="btn" onclick="testBase64()">üß™ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Base64</button>
            <button class="btn" onclick="testWithServer()">üöÄ –¢–µ—Å—Ç —Å —Å–µ—Ä–≤–µ—Ä–æ–º</button>
            
            <div id="result"></div>
        </div>
    </div>

    <script>
        async function testBase64() {
            const input = document.getElementById('base64Input').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!input) {
                resultDiv.innerHTML = '<div class="result error">–í–≤–µ–¥–∏—Ç–µ base64 —Å—Ç—Ä–æ–∫—É</div>';
                return;
            }
            
            try {
                // –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                const hasPrefix = input.startsWith('data:');
                const base64Only = hasPrefix ? input.replace(/^data:image\/[a-z]+;base64,/, '') : input;
                const padding = base64Only.length % 4;
                
                let isValid = false;
                try {
                    atob(base64Only);
                    isValid = true;
                } catch (e) {
                    isValid = false;
                }
                
                resultDiv.innerHTML = `
                    <div class="result ${isValid ? 'success' : 'error'}">
                        <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong><br>
                        –î–ª–∏–Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏: ${input.length}<br>
                        –ò–º–µ–µ—Ç data prefix: ${hasPrefix ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}<br>
                        –î–ª–∏–Ω–∞ base64: ${base64Only.length}<br>
                        Padding: ${padding} (${padding === 0 ? '‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π' : '‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π'})<br>
                        Base64 –≤–∞–ª–∏–¥–µ–Ω: ${isValid ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">–û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }
        
        async function testWithServer() {
            const input = document.getElementById('base64Input').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!input) {
                resultDiv.innerHTML = '<div class="result error">–í–≤–µ–¥–∏—Ç–µ base64 —Å—Ç—Ä–æ–∫—É</div>';
                return;
            }
            
            try {
                resultDiv.innerHTML = '<div class="result info">–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...</div>';
                
                const response = await fetch('/api/test-base64', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        photo_data: input
                    })
                });
                
                const result = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="result ${result.valid ? 'success' : 'error'}">
                        <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞:</strong><br>
                        Base64 –≤–∞–ª–∏–¥–µ–Ω: ${result.valid ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}<br>
                        –î–ª–∏–Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–π: ${result.originalLength}<br>
                        –î–ª–∏–Ω–∞ –æ—á–∏—â–µ–Ω–Ω–æ–π: ${result.cleanedLength}<br>
                        –ò–º–µ–µ—Ç data prefix: ${result.hasDataPrefix ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}<br>
                        –ü—Ä–∏–º–µ—Ä: ${result.sample}
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
